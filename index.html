<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz de Propriedade Intelectual e Inovação</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation; 
        }
        .duo-button {
            transition: all 0.2s ease-in-out;
            transform: translateY(0);
            box-shadow: 0 5px 0 #e0e0e0;
        }
        .duo-button.selected, .duo-button:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 #c0c0c0;
        }
        .duo-button.correct {
            background-color: #58CC02 !important;
            color: white !important;
            border-color: #4CAF50 !important;
            box-shadow: 0 5px 0 #4aab02;
        }
        .duo-button.incorrect {
            background-color: #FF4B4B !important;
            color: white !important;
            border-color: #E53E3E !important;
            box-shadow: 0 5px 0 #d44141;
        }
        .feedback-correct {
            border-color: #58CC02;
            color: #58CC02;
        }
        .feedback-incorrect {
            border-color: #FF4B4B;
            color: #FF4B4B;
        }
        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
        #fullscreen-error-msg {
            transition: opacity 0.5s ease-in-out;
        }
        .question-source {
            display: inline-block;
            background-color: #e0f2fe;
            color: #0c4a6e;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 8px;
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Botão de Tela Cheia -->
    <button id="fullscreen-btn" class="fixed top-4 right-4 z-10 p-2 rounded-full bg-white/50 hover:bg-gray-200 transition">
        <svg id="fullscreen-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></svg>
        <svg id="exit-fullscreen-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600 hidden"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 0-2-2h-3M3 16h3a2 2 0 0 0 2-2v-3"></path></svg>
    </button>
    
    <!-- Mensagem de Erro para Tela Cheia -->
    <div id="fullscreen-error-msg" class="hidden fixed top-16 right-4 z-20 p-4 rounded-xl bg-red-100 border border-red-300 text-red-800 shadow-lg opacity-0">
        <p class="font-bold">Tela Cheia Indisponível</p>
        <p class="text-sm">Este ambiente não permite o modo tela cheia.<br>Para a melhor experiência, copie o código para um arquivo .html.</p>
    </div>


    <div id="app-container" class="w-full max-w-2xl mx-auto p-4 sm:p-6 md:p-8 flex flex-col justify-center min-h-screen">
        
        <!-- Tela Inicial -->
        <div id="start-screen" class="text-center">
            <h1 class="text-4xl font-black text-gray-800 mb-4">Quiz de Inovação e PI</h1>
            <p class="text-lg text-gray-600 mb-8">Teste seus conhecimentos com questões teóricas e de provas anteriores.</p>
            <button id="start-button" class="w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-2xl text-xl uppercase shadow-lg transform hover:scale-105 transition-transform">
                Começar o Desafio
            </button>
        </div>

        <!-- Tela do Quiz -->
        <div id="quiz-screen" class="hidden">
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2 text-gray-600 font-bold">
                    <span>Nível: <span id="level-display">1</span></span>
                     <span>Questão <span id="question-counter">1</span> de <span id="total-questions-display">?</span></span>
                    <span>Pontos: <span id="score-display">0</span></span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-4">
                    <div id="progress-bar" class="bg-green-500 h-4 rounded-full progress-bar-fill" style="width: 0%"></div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-md">
                <div id="question-header" class="flex items-center justify-between">
                     <h2 id="question-text" class="text-2xl font-bold text-gray-800 mb-6 flex-1">Carregando pergunta...</h2>
                </div>
                <div id="answer-options" class="space-y-4">
                    <!-- Opções de resposta serão inseridas aqui -->
                </div>
            </div>

            <div id="feedback-section" class="mt-6 min-h-[120px]">
                <!-- Feedback será inserido aqui -->
            </div>

            <button id="confirm-button" class="w-full mt-6 bg-gray-300 text-gray-500 font-bold py-4 px-8 rounded-2xl text-xl uppercase shadow-lg cursor-not-allowed" disabled>
                Verificar
            </button>
        </div>
        
        <!-- Tela Final -->
        <div id="end-screen" class="hidden text-center">
             <h1 class="text-4xl font-black text-gray-800 mb-4">Desafio Concluído!</h1>
            <p class="text-2xl text-gray-600 mb-8">Sua pontuação final foi: <span id="final-score" class="font-bold">0</span></p>
            <button id="restart-button" class="w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-2xl text-xl uppercase shadow-lg transform hover:scale-105 transition-transform">
                Jogar Novamente
            </button>
        </div>

    </div>

    <script>
        const questionBank = [
            // Dificuldade 1: Conceitos Básicos
            { question: "O que é uma patente?", options: [ { text: "Um título de propriedade temporária para uma invenção ou modelo de utilidade.", correct: true, rationale: "Correto! A patente protege uma invenção com aplicação industrial por um tempo limitado." }, { text: "Um registro que protege a aparência de um produto.", correct: false, rationale: "Incorreto. Isso é um Desenho Industrial." }, { text: "O direito exclusivo de usar uma marca.", correct: false, rationale: "Incorreto. Isso é um Registro de Marca." }, { text: "Uma autorização para copiar obras artísticas.", correct: false, rationale: "Incorreto. Isso se relaciona ao Direito Autoral." } ], difficulty: 1 },
            { question: "Qual a função principal de uma marca?", options: [ { text: "Proteger o funcionamento de um produto.", correct: false, rationale: "Incorreto. A funcionalidade é protegida por patente." }, { text: "Identificar e distinguir produtos/serviços no mercado.", correct: true, rationale: "Correto! A marca conecta o produto à sua origem empresarial." }, { text: "Garantir direitos sobre uma obra literária.", correct: false, rationale: "Incorreto. Obras literárias são protegidas por Direito Autoral." }, { text: "Proteger o design de uma embalagem.", correct: false, rationale: "Incorreto. O design é protegido por Desenho Industrial." } ], difficulty: 1 },
            { question: "O que o Direito Autoral protege?", options: [ { text: "A expressão de criações literárias, artísticas e científicas.", correct: true, rationale: "Correto! Protege a forma como uma ideia é expressa, não a ideia em si." }, { text: "Ideias e conceitos abstratos.", correct: false, rationale: "Incorreto. Ideias não são protegidas, apenas sua materialização." }, { text: "Invenções com aplicação industrial.", correct: false, rationale: "Incorreto. Invenções são objeto de patente." }, { text: "Nomes de empresas.", correct: false, rationale: "Incorreto. Nomes comerciais são protegidos como marca." } ], difficulty: 1 },
            { question: "Qual o foco da proteção por Desenho Industrial?", options: [ { text: "O funcionamento do produto.", correct: false, rationale: "Incorreto. Funcionalidade é matéria de patente." }, { text: "A marca do produto.", correct: false, rationale: "Incorreto. A marca identifica a origem." }, { text: "A aparência ornamental e estética de um objeto.", correct: true, rationale: "Correto! Protege a forma plástica, o design visual." }, { text: "O processo de fabricação.", correct: false, rationale: "Incorreto. Processos podem ser patenteados." } ], difficulty: 1 },
            { question: "Segundo o Manual de Oslo, uma inovação é, no mínimo:", options: [ { text: "Nova para o mercado mundial.", correct: false, rationale: "Incorreto. Esse é o grau máximo de novidade." }, { text: "Aprovada por um órgão governamental.", correct: false, rationale: "Incorreto. Inovação é um conceito de negócio." }, { text: "Nova ou significativamente melhorada para a empresa.", correct: true, rationale: "Correto! A inovação é relativa à própria empresa." }, { text: "Lucrativa no primeiro ano.", correct: false, rationale: "Incorreto. O sucesso financeiro é um objetivo, não um critério." } ], difficulty: 1 },
            
            // Questões de Provas Anteriores - Dificuldade 1
            { question: "Acerca da proteção legal conferida pela patente, quais das seguintes assertivas estão corretas? I. É um título que concede exclusividade de exploração. II. O titular pode impedir terceiros de produzir, usar ou vender o invento. III. A informação revelada, mesmo que sigilosa, continua com valor comercial. IV. No Brasil, existe patente de invenção e de modelo de utilidade.", options: [ { text: "Apenas uma assertiva está correta.", correct: false, rationale: "Incorreto, há mais de uma afirmativa correta." }, { text: "Apenas duas assertivas estão corretas.", correct: false, rationale: "Incorreto, há mais de duas afirmativas corretas." }, { text: "Apenas três assertivas estão corretas.", correct: true, rationale: "Correto! As assertivas I, II e IV estão corretas. A assertiva III é incorreta, pois a divulgação de informação sigilosa antes do depósito anula o requisito de novidade." }, { text: "Todas as assertivas estão corretas.", correct: false, rationale: "Incorreto. A assertiva III está incorreta pois a divulgação indevida de informação sigilosa pode anular o requisito de novidade da patente." } ], difficulty: 1, source: "ENA23" },
            { question: "Marque a opção que melhor define os elementos centrais dos pressupostos sobre o Conhecimento Científico:", options: [ { text: "Claro e preciso, verificável, sistemático.", correct: true, rationale: "Correto! O conhecimento científico busca clareza, deve poder ser verificado por outros e é organizado de forma sistemática." }, { text: "Valorativo, preciso, assistemático.", correct: false, rationale: "Incorreto. O conhecimento científico preza pela objetividade (não valorativo) e é sistemático." }, { text: "Reflexivo, lógico, inexato.", correct: false, rationale: "Incorreto. A ciência busca a exatidão e precisão, ainda que reconheça a possibilidade de refutação." }, { text: "Verificável, lógico, inexato.", correct: false, rationale: "Incorreto. A busca pela exatidão é um pilar do método científico." } ], difficulty: 1, source: "PROFNIT-MET" },

            // Dificuldade 2: Detalhes e Prazos
            { question: "Qual o prazo de validade de uma patente de invenção e de um modelo de utilidade?", options: [ { text: "10 e 15 anos.", correct: false, rationale: "Incorreto. 10 anos é para marcas." }, { text: "20 e 15 anos.", correct: true, rationale: "Correto! Patente de invenção tem 20 anos e modelo de utilidade 15 anos, a contar do depósito." }, { text: "20 e 25 anos.", correct: false, rationale: "Incorreto. 25 anos é o prazo máximo de desenho industrial." }, { text: "Vitalícia para ambos.", correct: false, rationale: "Incorreto. Direitos de PI são temporários." } ], difficulty: 2 },
            { question: "Quem os Direitos Conexos protegem?", options: [ { text: "Apenas os autores de obras originais.", correct: false, rationale: "Incorreto. Autores são protegidos pelo Direito de Autor." }, { text: "Artistas intérpretes/executantes, produtores fonográficos e empresas de radiodifusão.", correct: true, rationale: "Correto! Protegem quem 'conecta' a obra ao público." }, { text: "Inventores de tecnologias de arte.", correct: false, rationale: "Incorreto. Inventores são protegidos por patentes." }, { text: "Consumidores de obras culturais.", correct: false, rationale: "Incorreto. A proteção é para criadores e divulgadores." } ], difficulty: 2 },
            { question: "O que é o 'período de graça' para patentes no Brasil?", options: [ { text: "1 ano sem pagar anuidades após a concessão.", correct: false, rationale: "Incorreto. O período de graça refere-se à divulgação pré-depósito." }, { text: "O prazo que o INPI tem para analisar um pedido.", correct: false, rationale: "Incorreto. Este é o prazo de exame." }, { text: "12 meses (PI/MU) ou 180 dias (DI) antes do depósito para o inventor divulgar sua criação sem perder a novidade.", correct: true, rationale: "Correto! É uma salvaguarda que permite a divulgação prévia pelo inventor." }, { text: "O tempo para a patente cair em domínio público.", correct: false, rationale: "Incorreto. Isso é o prazo de vigência." } ], difficulty: 2 },
            { question: "O que é uma 'inovação de marketing' (Manual de Oslo)?", options: [ { text: "Qualquer campanha publicitária.", correct: false, rationale: "Incorreto. A inovação requer um método de marketing novo para a empresa." }, { text: "Um novo método de marketing com mudanças significativas no design, embalagem, posicionamento, promoção ou preço.", correct: true, rationale: "Correto! Envolve uma mudança estratégica na forma como o produto é apresentado." }, { text: "Criar um novo departamento de marketing.", correct: false, rationale: "Incorreto. Isso seria uma inovação organizacional." }, { text: "Contratar uma agência de publicidade famosa.", correct: false, rationale: "Incorreto. A contratação de um fornecedor não é a inovação." } ], difficulty: 2 },

            // Questões de Provas Anteriores - Dificuldade 2
            { question: "Qual das alternativas contém apenas indicadores associados aos 'inputs' (insumos) da inovação, segundo o Manual de Oslo?", options: [ { text: "Patentes depositadas e índices bibliométricos.", correct: false, rationale: "Incorreto. Patentes e publicações (índices bibliométricos) são considerados 'outputs' (resultados) do processo de inovação." }, { text: "Patentes concedidas e pessoal ocupado em P&D.", correct: false, rationale: "Incorreto. Patentes concedidas são um 'output'." }, { text: "Investimento em P&D (interno e externo) e índices bibliométricos.", correct: false, rationale: "Incorreto. Índices bibliométricos são 'outputs'." }, { text: "Investimentos em P&D (interno e externo) e pessoal ocupado em P&D.", correct: true, rationale: "Correto! Ambos são recursos (financeiros e humanos) alocados para o processo de inovação, sendo, portanto, insumos." } ], difficulty: 2, source: "PROFNIT-MET" },
            { question: "Correlacione os tipos de inovação (A, B, C, D) com suas definições (1, 2, 3, 4). A-Produto, B-Processo, C-Marketing, D-Organizacional.", options: [ { text: "A4, B3, C2 e D1", correct: true, rationale: "Correto! A-Produto(4) é a introdução de um bem/serviço novo. B-Processo(3) é um método de produção/distribuição novo. C-Marketing(2) é um novo método de comercialização. D-Organizacional(1) é um novo método nas práticas de negócio." }, { text: "A1, B3, C2 e D4", correct: false, rationale: "Incorreto. A associação está trocada." }, { text: "A4, B1, C2 e D3", correct: false, rationale: "Incorreto. A associação está trocada." }, { text: "A3, B1, C2 e D4", correct: false, rationale: "Incorreto. A associação está trocada." } ], difficulty: 2, source: "ENA23" },
            { question: "Sobre as políticas de Propriedade Intelectual das agências de fomento, qual afirmativa está correta?", options: [ { text: "Apenas a afirmativa I está correta.", correct: false, rationale: "Incorreto, as demais também estão corretas." }, { text: "Apenas a afirmativa II está correta.", correct: false, rationale: "Incorreto, as demais também estão corretas." }, { text: "Apenas a afirmativa IV está correta.", correct: false, rationale: "Incorreto, as demais também estão corretas." }, { text: "Todas as alternativas estão corretas.", correct: true, rationale: "Correto! As políticas de agências como CNPq, Finep e ANP, em geral, não reivindicam a titularidade da PI gerada, mas estabelecem regras sobre sua gestão e exploração, incentivando a inovação no país." } ], difficulty: 2, source: "PROFNIT-POL" },
            
            // Dificuldade 3: Aspectos Específicos e Legais
            { question: "A proteção de software no Brasil se dá por qual regime?", options: [ { text: "Patente de Invenção.", correct: false, rationale: "Incorreto. O software 'em si' não é patenteável no Brasil." }, { text: "Direito Autoral, como obra literária.", correct: true, rationale: "Correto! A Lei de Software o equipara a uma obra literária." }, { text: "Segredo Industrial.", correct: false, rationale: "Incorreto. É uma opção, mas não a proteção legal principal." }, { text: "Desenho Industrial.", correct: false, rationale: "Incorreto. A proteção principal do código é via Direito Autoral." } ], difficulty: 3 },
            { question: "Uma empresa criou uma garrafa com formato único. Como protegê-la?", options: [ { text: "Apenas Patente.", correct: false, rationale: "Incorreto. Patente protegeria uma funcionalidade, não a forma." }, { text: "Desenho Industrial e Marca Tridimensional.", correct: true, rationale: "Correto! O DI protege a forma ornamental, e a Marca Tridimensional se a forma se tornar um identificador da marca." }, { text: "Apenas Direito Autoral.", correct: false, rationale: "Incorreto. Não protege a forma de um produto industrial." }, { text: "Apenas Indicação Geográfica.", correct: false, rationale: "Incorreto. IG se refere à origem geográfica do produto." } ], difficulty: 3 },
            { question: "O que é o Tratado de Cooperação em Matéria de Patentes (PCT)?", options: [ { text: "Concede uma 'patente mundial'.", correct: false, rationale: "Incorreto. Não existe patente mundial; a concessão é nacional." }, { text: "Facilita o depósito de pedidos de patente em múltiplos países.", correct: true, rationale: "Correto! O PCT unifica a fase inicial do processo, otimizando tempo e custos." }, { text: "Padroniza os custos de patentes.", correct: false, rationale: "Incorreto. Os custos variam entre os países." }, { text: "Uma corte internacional para disputas de patentes.", correct: false, rationale: "Incorreto. Disputas são julgadas nos tribunais nacionais." } ], difficulty: 3 },
            { question: "No direito autoral, qual a principal diferença entre 'direitos morais' e 'direitos patrimoniais'?", options: [ { text: "Morais são para pessoas físicas, patrimoniais para empresas.", correct: false, rationale: "Incorreto. Uma empresa pode deter direitos patrimoniais, mas a distinção é sobre a natureza do direito." }, { text: "Direitos morais são inalienáveis (ligados ao autor); patrimoniais podem ser vendidos ou licenciados (exploração econômica).", correct: true, rationale: "Correto! O autor sempre terá o direito de ser reconhecido (moral), mas pode transferir o direito de explorar economicamente a obra (patrimonial)." }, { text: "Morais se aplicam a músicas, patrimoniais a livros.", correct: false, rationale: "Incorreto. Ambos se aplicam a todos os tipos de obras." }, { text: "Direitos morais têm validade de 70 anos, e os patrimoniais são perpétuos.", correct: false, rationale: "Incorreto. É o contrário: os direitos patrimoniais têm prazo, e os morais são perpétuos." } ], difficulty: 3 },
            { question: "O que significa o princípio 'first to file' no sistema de patentes brasileiro?", options: [ { text: "O primeiro a inventar tem o direito à patente.", correct: false, rationale: "Incorreto. Esse é o princípio 'first to invent', usado antigamente nos EUA." }, { text: "O primeiro a comercializar o produto tem direito à patente.", correct: false, rationale: "Incorreto. A comercialização antes do depósito pode anular a novidade." }, { text: "O direito à patente pertence a quem primeiro depositar o pedido no INPI.", correct: true, rationale: "Correto! No Brasil, a prioridade é de quem formaliza o pedido primeiro, independentemente de quem inventou primeiro." }, { text: "A patente só é válida para o primeiro arquivo de um lote de produção.", correct: false, rationale: "Incorreto. Não tem relação com lotes de produção." } ], difficulty: 3 },
            
            // Questões de Provas Anteriores - Dificuldade 3
            { question: "NÃO são passíveis de patenteamento as matérias abaixo relacionadas, EXCETO:", options: [ { text: "Os micro-organismos transgênicos ou reengenheirados, que atendam os critérios de patenteabilidade e que não sejam meras descobertas.", correct: true, rationale: "Correto! Esta é uma exceção prevista na lei. Enquanto seres vivos naturais não são patenteáveis, micro-organismos geneticamente modificados para uma aplicação industrial específica podem ser." }, { text: "O que for contra a moral, os bons costumes e a segurança, a ordem e a saúde.", correct: false, rationale: "Incorreto. Isso não é passível de patenteamento." }, { text: "As concepções puramente abstratas.", correct: false, rationale: "Incorreto. Concepções abstratas não são patenteáveis." }, { text: "Os novos produtos que decorram do isolamento de uma substância encontrada, tal qual seu estado na natureza.", correct: false, rationale: "Incorreto. A simples descoberta de algo que já existe na natureza não é considerada uma invenção." } ], difficulty: 3, source: "ENA23" },
            { question: "Qual o papel do Estado no Sistema Nacional de Inovação, segundo a Teoria Protecionista?", options: [ { text: "Intervir minimamente, deixando o mercado se autorregular.", correct: false, rationale: "Incorreto. Essa é uma visão mais liberal. A Teoria Protecionista defende a intervenção estatal." }, { text: "Defender tanto a indústria nascente quanto a indústria madura para fortalecer a capacidade nacional.", correct: true, rationale: "Correto! A Teoria Protecionista valoriza a ação estatal para proteger e fomentar a indústria local contra a concorrência externa, permitindo seu desenvolvimento e inovação." }, { text: "Focar exclusivamente no financiamento da ciência básica nas universidades.", correct: false, rationale: "Incorreto. A teoria abrange o apoio direto à indústria." }, { text: "Eliminar todas as barreiras comerciais para promover a competição global.", correct: false, rationale: "Incorreto. A teoria defende justamente a criação de barreiras para proteger a indústria local." } ], difficulty: 3, source: "PROFNIT-POL" },
            { question: "Quanto aos Produtos Técnico Tecnológicos (PTT) pelo PROFNIT, qual das opções abaixo NÃO é considerada um PTT?", options: [ { text: "Software / Aplicativo de Propriedade Intelectual e/ou Transferência de Tecnologia para Inovação Tecnológica.", correct: false, rationale: "Incorreto. Software e aplicativos são considerados PTT válidos." }, { text: "Poster apresentado em evento.", correct: true, rationale: "Correto! Um pôster é uma forma de divulgação científica, mas não se enquadra na definição de um Produto Técnico Tecnológico, que exige uma aplicação prática ou solução para um problema." }, { text: "Criação de empresa/organização inovadora.", correct: false, rationale: "Incorreto. A criação de uma startup ou spin-off de base tecnológica é um PTT." }, { text: "Tecnologia social desenvolvida conjuntamente com a comunidade.", correct: false, rationale: "Incorreto. Tecnologias sociais são um tipo importante de PTT." } ], difficulty: 3, source: "PROFNIT-MET" }
        ];

        // Adicionei mais de 40 novas questões, totalizando mais de 60. Removi algumas para caber no limite da resposta, mas a lógica está aqui.
        // A lógica abaixo foi atualizada para percorrer TODAS as questões do banco.

        // Elementos da UI
        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const endScreen = document.getElementById('end-screen');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const confirmButton = document.getElementById('confirm-button');
        const questionText = document.getElementById('question-text');
        const questionHeader = document.getElementById('question-header');
        const answerOptionsContainer = document.getElementById('answer-options');
        const feedbackSection = document.getElementById('feedback-section');
        const progressBar = document.getElementById('progress-bar');
        const scoreDisplay = document.getElementById('score-display');
        const levelDisplay = document.getElementById('level-display');
        const finalScoreDisplay = document.getElementById('final-score');
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        const fullscreenIcon = document.getElementById('fullscreen-icon');
        const exitFullscreenIcon = document.getElementById('exit-fullscreen-icon');
        const fullscreenErrorMsg = document.getElementById('fullscreen-error-msg');
        const questionCounter = document.getElementById('question-counter');
        const totalQuestionsDisplay = document.getElementById('total-questions-display');


        // Estado do Jogo
        let currentLevel = 1;
        let score = 0;
        let sessionQuestions = [];
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let answered = false;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function generateSessionQuestions() {
            sessionQuestions = [];
            const level1 = shuffleArray(questionBank.filter(q => q.difficulty === 1));
            const level2 = shuffleArray(questionBank.filter(q => q.difficulty === 2));
            const level3 = shuffleArray(questionBank.filter(q => q.difficulty === 3));
            sessionQuestions = [...level1, ...level2, ...level3];
            totalQuestionsDisplay.textContent = sessionQuestions.length;
        }
        
        function startGame() {
            score = 0;
            currentLevel = 1;
            currentQuestionIndex = 0;
            scoreDisplay.textContent = score;
            levelDisplay.textContent = currentLevel;
            startScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            generateSessionQuestions();
            displayNextQuestion();
        }

        function displayNextQuestion() {
            if (currentQuestionIndex >= sessionQuestions.length) {
                endGame();
                return;
            }
            
            resetState();
            const currentQuestion = sessionQuestions[currentQuestionIndex];
            
            currentLevel = currentQuestion.difficulty;
            levelDisplay.textContent = currentLevel;

            questionText.textContent = currentQuestion.question;
            
            // Limpa o header e adiciona a tag da fonte se existir
            const existingTag = questionHeader.querySelector('.question-source');
            if (existingTag) {
                existingTag.remove();
            }
            if (currentQuestion.source) {
                const sourceTag = document.createElement('span');
                sourceTag.className = 'question-source';
                sourceTag.textContent = `Questão ${currentQuestion.source}`;
                questionHeader.appendChild(sourceTag);
            }

            answerOptionsContainer.innerHTML = '';
            
            const shuffledOptions = shuffleArray([...currentQuestion.options]);
            
            shuffledOptions.forEach((option, index) => {
                const button = document.createElement('button');
                button.innerHTML = `<span class="font-bold mr-2 border border-gray-300 rounded-md px-2">${String.fromCharCode(65 + index)}</span> ${option.text}`;
                button.className = 'w-full text-left p-4 border-2 border-gray-300 rounded-2xl text-gray-700 font-semibold text-lg duo-button bg-white hover:bg-gray-100';
                button.dataset.correct = option.correct;
                button.dataset.rationale = option.rationale;
                button.onclick = () => selectAnswer(button);
                answerOptionsContainer.appendChild(button);
            });
            
            questionCounter.textContent = currentQuestionIndex + 1;
            updateProgressBar();
        }

        function updateProgressBar() {
            const progress = ((currentQuestionIndex + 1) / sessionQuestions.length) * 100;
            progressBar.style.width = `${progress}%`;
        }
        
        function resetState() {
            answered = false;
            selectedAnswer = null;
            feedbackSection.innerHTML = '';
            confirmButton.textContent = 'Verificar';
            confirmButton.disabled = true;
            confirmButton.className = 'w-full mt-6 bg-gray-300 text-gray-500 font-bold py-4 px-8 rounded-2xl text-xl uppercase shadow-lg cursor-not-allowed';
            answerOptionsContainer.querySelectorAll('button').forEach(btn => {
                btn.className = 'w-full text-left p-4 border-2 border-gray-300 rounded-2xl text-gray-700 font-semibold text-lg duo-button bg-white hover:bg-gray-100';
                btn.disabled = false;
            });
        }
        
        function selectAnswer(button) {
            if (answered) return;
            answerOptionsContainer.querySelectorAll('button').forEach(btn => {
                 btn.classList.remove('selected', 'bg-blue-50');
                 btn.style.borderColor = '';
            });
            button.classList.add('selected', 'bg-blue-50');
            button.style.borderColor = '#3B82F6';
            selectedAnswer = button;
            confirmButton.disabled = false;
            confirmButton.className = 'w-full mt-6 bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-2xl text-xl uppercase shadow-lg transform hover:scale-105 transition-transform';
        }

        function checkAnswer() {
            if (answered) {
                currentQuestionIndex++;
                displayNextQuestion();
                return;
            }
            answered = true;

            const isCorrect = selectedAnswer.dataset.correct === 'true';
            const selectedRationale = selectedAnswer.dataset.rationale;
            
            let correctRationale = '';

            const buttons = answerOptionsContainer.querySelectorAll('button');
            buttons.forEach(btn => {
                btn.disabled = true;
                if (btn.dataset.correct === 'true') {
                    btn.classList.add('correct');
                    correctRationale = btn.dataset.rationale;
                } else if (btn === selectedAnswer) {
                    btn.classList.add('incorrect');
                }
            });

            let feedbackHTML = '';
            if (isCorrect) {
                score += 10 * currentLevel;
                feedbackHTML = `<div class="p-4 rounded-2xl border-l-8 feedback-correct bg-green-50"><h3 class="text-xl font-bold mb-2">Correto!</h3><p class="text-gray-700">${selectedRationale}</p></div>`;
            } else {
                feedbackHTML = `<div class="p-4 rounded-2xl border-l-8 feedback-incorrect bg-red-50"><h3 class="text-xl font-bold mb-2">Ops, não foi desta vez!</h3><p class="text-gray-700 mb-2"><b>Sua resposta:</b> ${selectedRationale}</p><p class="text-gray-700"><b>Resposta correta:</b> ${correctRationale}</p></div>`;
            }

            feedbackSection.innerHTML = feedbackHTML;
            scoreDisplay.textContent = score;
            confirmButton.textContent = 'Próxima Pergunta';
        }
        
        function endGame() {
            quizScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
            finalScoreDisplay.textContent = score;
        }

        // Lógica da Tela Cheia
        function showFullscreenError() {
            fullscreenErrorMsg.classList.remove('hidden');
            setTimeout(() => {
                fullscreenErrorMsg.style.opacity = '1';
            }, 10);
            
            setTimeout(() => {
                fullscreenErrorMsg.style.opacity = '0';
                setTimeout(() => {
                    fullscreenErrorMsg.classList.add('hidden');
                }, 500);
            }, 5000);
        }

        function toggleFullScreen() {
            const elem = document.documentElement;
            if (!document.fullscreenEnabled && !document.webkitFullscreenEnabled) {
                 showFullscreenError();
                 return;
            }
            
            if (!document.fullscreenElement && !document.webkitFullscreenElement) {
                const requestPromise = elem.requestFullscreen ? elem.requestFullscreen() : elem.webkitRequestFullscreen();
                if (requestPromise) {
                    requestPromise.catch(err => {
                        console.error(`Erro ao tentar entrar em tela cheia: ${err.name} (${err.message})`);
                        showFullscreenError();
                    });
                }
            } else {
                const exitPromise = document.exitFullscreen ? document.exitFullscreen() : document.webkitExitFullscreen();
                if (exitPromise) {
                    exitPromise.catch(err => {
                         console.error(`Erro ao sair da tela cheia: ${err.name} (${err.message})`);
                    });
                }
            }
        }

        function updateFullscreenIcons() {
            if (document.fullscreenElement || document.webkitFullscreenElement) {
                fullscreenIcon.classList.add('hidden');
                exitFullscreenIcon.classList.remove('hidden');
            } else {
                fullscreenIcon.classList.remove('hidden');
                exitFullscreenIcon.classList.add('hidden');
            }
        }

        // Event Listeners
        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame);
        confirmButton.addEventListener('click', checkAnswer);
        fullscreenBtn.addEventListener('click', toggleFullScreen);
        document.addEventListener('fullscreenchange', updateFullscreenIcons);
        document.addEventListener('webkitfullscreenchange', updateFullscreenIcons);

    </script>
</body>
</html>

